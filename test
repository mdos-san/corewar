#!/bin/sh

touch out
touch target

test() {
	echo "Testing $1: \c"
	`./corewar -d $2 ./tests/$1 > out` 2> error
	`./ressources/corewar -d $2 ./tests/$1 > target`
	DIFF=`diff out target`
	ERROR=`cat error`
	if [ "$DIFF" = "" ]
	then
		echo "\033[32m[OK]\033[0m"
	elif [ "$ERROR" != "" ]
	then
		echo "\033[31m[KO: `cat error`]\033[0m"
		exit
	else
		echo "\033[31m[KO]\033[0m"
		exit
	fi
}

make re
clear
test st_1.cor 5
test st_2.cor 5 
test st_3.cor 5
test st_4.cor 5
test st_5.cor 5
test st_6.cor 5
test st_7.cor 5
test st_8.cor 5
test st_9.cor 5
test ld_st_1.cor 10
test ld_st_2.cor 10
test ld_st_3.cor 10
test ld_st_4.cor 10
test ld_st_5.cor 10
test ld_st_6.cor 10
test add_st_1.cor 15
test add_st_2.cor 15
test sub_st_1.cor 15
test sub_st_2.cor 15
test and_st_1.cor 11
test and_st_2.cor 11
test and_st_3.cor 11
test or_st_1.cor 11
test or_st_2.cor 11
test or_st_3.cor 11
test xor_st_1.cor 11
test xor_st_2.cor 11
test xor_st_3.cor 11
test sti_1.cor 25
test sti_2.cor 25
test sti_3.cor 25
test sti_4.cor 25
test sti_5.cor 25

make fclean > /dev/null
